<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article - Don Barger</title>
    <link rel="stylesheet" href="tool-styles.css">
    <link rel="stylesheet" href="post-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="tool-nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <span class="nav-coffee">☕</span>
                <span class="nav-brand">Don Barger</span>
            </a>
            <div class="nav-links">
                <a href="blog.html" class="nav-link active">Don's Blog</a>
                <a href="faithbot.html" class="nav-link">FaithBot</a>
                <a href="biblepics.html" class="nav-link">BiblePics</a>
                <a href="youversion.html" class="nav-link">YouVersion</a>
                <a href="goals.html" class="nav-link">SMART Goals</a>
                <a href="coffeecoach.html" class="nav-link">Coffee Coach</a>
            </div>
            <a href="index.html" class="nav-home">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
                Home
            </a>
        </div>
    </nav>
    
    <div class="post-container">
        <div class="post-header-wrapper">
            <a href="blog.html" class="back-link">← Back to Blog</a>
            <div id="post-info" class="post-info"></div>
        </div>
        <div class="post-iframe-wrapper">
            <iframe id="post-frame" frameborder="0" title="Blog Post"></iframe>
        </div>
    </div>
    
    <div class="bmc-footer">
        <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="donbarger" data-color="#FFDD00" data-emoji=""  data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>
    </div>
    
    <script>
        // Get article URL from query parameter
        const urlParams = new URLSearchParams(window.location.search);
        const articleUrl = urlParams.get('url');
        
        async function loadArticle() {
            const iframe = document.getElementById('post-frame');
            const postInfo = document.getElementById('post-info');
            
            if (!articleUrl) {
                postInfo.innerHTML = '<div class="error"><p>No article specified. <a href="blog.html">Return to blog</a></p></div>';
                return;
            }
            
            // Show loading state
            postInfo.innerHTML = '<div class="loading">Loading article...</div>';
            
            // Set iframe source to article URL
            iframe.src = articleUrl;
            
            // Try to get article metadata from RSS to show title
            try {
                const rssUrl = 'https://donbarger.substack.com/feed';
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(rssUrl)}`);
                const data = await response.json();
                
                if (data.contents) {
                    const parser = new DOMParser();
                    const xml = parser.parseFromString(data.contents, 'text/xml');
                    const items = xml.querySelectorAll('item');
                    
                    // Find the matching article
                    const article = Array.from(items).find(item => {
                        const link = item.querySelector('link')?.textContent;
                        return link === articleUrl;
                    });
                    
                    if (article) {
                        const title = article.querySelector('title')?.textContent || '';
                        const pubDate = article.querySelector('pubDate')?.textContent || '';
                        
                        if (title) {
                            postInfo.innerHTML = `
                                <div class="article-meta">
                                    <h1 class="article-title">${title}</h1>
                                    ${pubDate ? `<p class="article-date">${new Date(pubDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>` : ''}
                                </div>
                            `;
                        } else {
                            postInfo.innerHTML = '';
                        }
                    } else {
                        postInfo.innerHTML = '';
                    }
                }
            } catch (error) {
                console.log('Could not load article metadata');
                postInfo.innerHTML = '';
            }
            
            // Handle iframe load
            iframe.onload = function() {
                console.log('Article loaded successfully');
            };
            
            iframe.onerror = function() {
                postInfo.innerHTML = `
                    <div class="error">
                        <h2>Unable to load article</h2>
                        <p>Please read this article directly on Substack:</p>
                        <a href="${articleUrl}" target="_blank" rel="noopener noreferrer" class="subscribe-button">Read on Substack →</a>
                    </div>
                `;
            };
        }
        
        loadArticle();
    </script>
</body>
</html>
