<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don's Blog - Don Barger</title>
    <link rel="stylesheet" href="tool-styles.css">
    <link rel="stylesheet" href="blog-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="tool-nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <span class="nav-coffee">☕</span>
                <span class="nav-brand">Don Barger</span>
            </a>
            <div class="nav-links">
                <a href="blog.html" class="nav-link active">Don's Blog</a>
                <a href="faithbot.html" class="nav-link">FaithBot</a>
                <a href="biblepics.html" class="nav-link">BiblePics</a>
                <a href="youversion.html" class="nav-link">YouVersion</a>
                <a href="goals.html" class="nav-link">SMART Goals</a>
                <a href="coffeecoach.html" class="nav-link">Coffee Coach</a>
            </div>
            <a href="index.html" class="nav-home">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
                Home
            </a>
        </div>
    </nav>
    
    <div class="blog-container">
        <div class="blog-header">
            <h1>Don's Blog</h1>
            <p>Thoughts on Innovation, AI, Faith, and Coffee</p>
        </div>
        
        <div class="blog-content" id="blog-articles">
            <div class="loading">Loading articles...</div>
        </div>
    </div>
    
    <div class="bmc-footer">
        <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="donbarger" data-color="#FFDD00" data-emoji=""  data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>
    </div>
    
    <script>
        // Fetch and display Substack articles from RSS feed
        async function loadBlogPosts() {
            const container = document.getElementById('blog-articles');
            
            try {
                // Try fetching directly from Substack RSS feed using a CORS proxy
                const rssUrl = 'https://donbarger.substack.com/feed';
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(rssUrl)}`);
                const data = await response.json();
                
                if (data.contents) {
                    // Parse the RSS XML
                    const parser = new DOMParser();
                    const xml = parser.parseFromString(data.contents, 'text/xml');
                    const items = xml.querySelectorAll('item');
                    
                    console.log('Found', items.length, 'articles');
                    
                    if (items.length > 0) {
                        const articles = Array.from(items).map(item => {
                            const title = item.querySelector('title')?.textContent || 'Untitled';
                            const link = item.querySelector('link')?.textContent || '#';
                            const pubDate = item.querySelector('pubDate')?.textContent || '';
                            const description = item.querySelector('description')?.textContent || '';
                            
                            // Try multiple methods to get content with images
                            let content = '';
                            
                            // Method 1: content:encoded (most common)
                            const encoded = Array.from(item.children).find(el => 
                                el.tagName === 'content:encoded' || el.localName === 'encoded'
                            );
                            if (encoded) {
                                content = encoded.textContent;
                            }
                            
                            // Method 2: description often has HTML
                            if (!content && description) {
                                content = description;
                            }
                            
                            // Extract thumbnail from multiple sources
                            let thumbnail = '';
                            
                            // Try 1: Extract from content HTML
                            if (content) {
                                const imgMatches = content.match(/<img[^>]+src=["']([^"'>]+)["'][^>]*>/gi);
                                if (imgMatches && imgMatches.length > 0) {
                                    const srcMatch = imgMatches[0].match(/src=["']([^"'>]+)["']/i);
                                    if (srcMatch && srcMatch[1]) {
                                        thumbnail = srcMatch[1];
                                    }
                                }
                            }
                            
                            // Try 2: media:thumbnail or media:content
                            if (!thumbnail) {
                                const mediaThumbnail = Array.from(item.children).find(el =>
                                    el.tagName === 'media:thumbnail' || 
                                    el.localName === 'thumbnail' ||
                                    el.tagName === 'media:content'
                                );
                                if (mediaThumbnail) {
                                    thumbnail = mediaThumbnail.getAttribute('url') || '';
                                }
                            }
                            
                            // Try 3: enclosure tag (sometimes used for images)
                            if (!thumbnail) {
                                const enclosure = item.querySelector('enclosure[type^="image"]');
                                if (enclosure) {
                                    thumbnail = enclosure.getAttribute('url') || '';
                                }
                            }
                            
                            console.log('Article:', title, 'Image:', thumbnail ? 'Found' : 'None');
                            
                            // Clean description (remove HTML tags)
                            const cleanDesc = description.replace(/<[^>]*>/g, '').substring(0, 200).trim();
                            
                            return { title, link, pubDate, description: cleanDesc, thumbnail };
                        });
                        
                        container.innerHTML = '<div class="articles-grid">' + 
                            articles.map(post => `
                                <article class="blog-post">
                                    ${post.thumbnail ? `<img src="${post.thumbnail}" alt="${post.title}" class="post-image" onerror="this.style.display='none'">` : '<div class="no-image"></div>'}
                                    <div class="post-content">
                                        <h2 class="post-title"><a href="post.html?url=${encodeURIComponent(post.link)}">${post.title}</a></h2>
                                        <p class="post-date">${new Date(post.pubDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                                        <p class="post-excerpt">${post.description}${post.description ? '...' : ''}</p>
                                        <a href="post.html?url=${encodeURIComponent(post.link)}" class="read-more">Read More →</a>
                                    </div>
                                </article>
                            `).join('') + 
                            '</div>' +
                            '<div class="subscribe-cta">' +
                                '<h3>Want more?</h3>' +
                                '<p>Subscribe to get my latest articles delivered to your inbox</p>' +
                                '<a href="https://donbarger.substack.com" target="_blank" rel="noopener noreferrer" class="subscribe-button">Subscribe on Substack</a>' +
                            '</div>';
                    } else {
                        throw new Error('No articles found');
                    }
                } else {
                    throw new Error('Unable to fetch RSS');
                }
            } catch (error) {
                console.error('Blog loading error:', error);
                container.innerHTML = `
                    <div class="error">
                        <h3>Articles Coming Soon!</h3>
                        <p>I'm working on bringing my articles here. In the meantime, check out my latest writing:</p>
                        <a href="https://donbarger.substack.com" target="_blank" rel="noopener noreferrer" class="subscribe-button">Visit My Substack →</a>
                    </div>
                `;
            }
        }
        
        loadBlogPosts();
    </script>
</body>
</html>
